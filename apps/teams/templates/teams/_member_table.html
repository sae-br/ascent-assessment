{% comment %}
Reusable member table.
Context:
- team (required)
- selected_team (optional; falls back to team)
- use_htmx (bool) -> when true, forms post via HTMX to teams:member_table and swap #member-table
- form_action (optional non-JS fallback). If omitted, defaults to teams:teams_overview
{% endcomment %}

{% if team %}
  {% url 'teams:teams_overview' as default_action %}
  {% url 'teams:member_table' team.id as htmx_url %}
  {% with action_url=form_action|default:default_action %}
  
  <div id="member-table">
    <h3>Team Members in {{ team.name }}</h3>

    <div class="table-wrapper">
      <table class="table">
        <colgroup>
          <col style="width: 38%">
          <col style="width: 42%">
          <col style="width: 20%">
        </colgroup>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th class="rightmost-column">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for member in team.members.all %}
            <tr>
              <form method="post"
                    action="{{ action_url }}"
                    {% if use_htmx %}hx-post="{{ htmx_url }}" hx-target="#member-table" hx-swap="outerHTML"{% endif %}
                    style="display: contents;">
                {% csrf_token %}
                <input type="hidden" name="selected_team" value="{{ selected_team.id|default:team.id }}">
                <input type="hidden" name="member_id" value="{{ member.id }}">

                <td data-label="Name">
                  <input type="text" name="edit_member_name" value="{{ member.name }}" required>
                </td>
                <td data-label="Email">
                  <input type="email" name="edit_member_email" value="{{ member.email }}" required>
                </td>
                <td class="actions-cell" data-label="Actions">
                  <div class="actions-stack">
                    <button type="submit" name="edit_member" class="text-button">Update</button>
                    <span class="actions-sep" aria-hidden="true">|</span>
                    <button type="submit" name="delete_member" class="text-button"
                            onclick="return confirm('Are you sure you want to delete this member?')">Delete</button>
                  </div>
                </td>
              </form>
            </tr>
          {% empty %}
            <tr><td colspan="3">No members yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <form method="post"
          action="{{ action_url }}"
          class="form--extend-table"
          {% if use_htmx %}
            hx-post="{{ htmx_url }}" 
            hx-target="#member-table" 
            hx-swap="outerHTML"
          {% endif %}>
      <p><em>Add New Member:</em></p>
      {% csrf_token %}
      <input type="hidden" name="selected_team" value="{{ selected_team.id|default:team.id }}">
      <input type="text"  name="new_member_name"  placeholder="Name"  required>
      <input type="email" name="new_member_email" placeholder="Email" required>
      <button type="submit" name="add_member" class="button">Add</button>
    </form>
  </div>

  {% endwith %}
{% endif %}